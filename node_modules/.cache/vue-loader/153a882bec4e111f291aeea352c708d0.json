{"remainingRequest":"C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\src\\main\\system\\account_manager.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\src\\main\\system\\account_manager.vue","mtime":1598080583802},{"path":"C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\钟学刚\\Desktop\\jfzx-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n\tname: 'basetable',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttableLoading: true,\r\n\t\t\ttableData: [],\r\n\t\t\tcur_page: 1,\r\n\t\t\tcur_total: 0,\r\n\t\t\tpageSize: 10,\r\n\t\t\tcurrentPage: 1,\r\n\t\t\tmultipleSelection: [],\r\n\t\t\tuserNameSelect: '',\r\n\t\t\tdel_list: [],\r\n\t\t\tis_search: false,\r\n\t\t\teditVisible: false,\r\n\t\t\tdelVisible: false,\r\n\t\t\tmenuEditVisible: false,\r\n\t\t\tform: {\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tagainPassword: ''\r\n\t\t\t},\r\n\r\n\t\t\tmenuForm: {\r\n\t\t\t\tparentMenuId: [1],\r\n\t\t\t\tmenuName: '',\r\n\t\t\t\tmenuUrl: '',\r\n\t\t\t\tmenuStatus: null\r\n\t\t\t},\r\n\t\t\tparentMenuIdOptions: [],\r\n\t\t\tprops: {\r\n\t\t\t\tvalue: 'menuId',\r\n\t\t\t\tlabel: 'menuName',\r\n\t\t\t\tchildren: 'childs',\r\n\t\t\t\tcheckStrictly:true\r\n\t\t\t},\r\n\r\n\t\t\tpasswordVisible: false,\r\n\t\t\tpasswordForm: {\r\n\t\t\t\tid: '',\r\n\t\t\t\tuserName: '',\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tnewPassword: '',\r\n\t\t\t\tagainPassword: ''\r\n\t\t\t},\r\n\r\n\t\t\tauthorizeVisible: false,\r\n\t\t\tauthorizeData: [],\r\n\t\t\tauthorizeForm: {\r\n\t\t\t\taccountId: '',\r\n\t\t\t\tmenuIds: []\r\n\t\t\t},\r\n\t\t\tdefaultProps: {\r\n\t\t\t\tchildren: 'childs',\r\n\t\t\t\tvalue: 'menuId',\r\n\t\t\t\tlabel: 'menuName'\r\n\t\t\t},\r\n\t\t\tdelId: -1\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.findAccountByPage();\r\n\t\tthis.getData();\r\n\t},\r\n\tmethods: {\r\n\t\t// 分页导航\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.currentPage = val;\r\n\t\t\tthis.cur_page = val;\r\n\t\t\tthis.findAccountByPage();\r\n\t\t},\r\n\t\thandleSizeChange(val) {\r\n\t\t\tthis.currentPage = 1;\r\n\t\t\tthis.cur_page = 1;\r\n\t\t\tthis.pageSize = val;\r\n\t\t\tthis.findAccountByPage();\r\n\t\t},\r\n\t\t// 获取 easy-mock 的模拟数据\r\n\t\tgetData() {\r\n\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=').then(res => {\r\n\t\t\t\tvar list = res.data.data;\r\n\t\t\t\tfor (var i = 0; i < list.length; i++) {\r\n\t\t\t\t\tvar childsTemp = '';\r\n\t\t\t\t\tif (res.data.data[i].childs != null && res.data.data[i].childs != 0) {\r\n\t\t\t\t\t\tchildsTemp = res.data.data[i].childs;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.authorizeData.push({\r\n\t\t\t\t\t\tmenuId: res.data.data[i].menuId,\r\n\t\t\t\t\t\tmenuName: res.data.data[i].menuName,\r\n\t\t\t\t\t\tchilds: childsTemp\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tsearch() {\r\n\t\t\tthis.cur_page = 1;\r\n\t\t\tthis.findAccountByPage();\r\n\t\t},\r\n\t\tinitFrom() {\r\n\t\t\t//初始表单数据\r\n\t\t\tthis.parentMenuIdOptions = [];\r\n\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=').then(res => {\r\n\t\t\t\tthis.parentMenuIdOptions = this.formatterMenu(res.data.data);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化菜单数据\r\n\t\tformatterMenu(arr) {\r\n\t\t\tlet newArr = [];\r\n\t\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\t\tif (arr[i].childrens && arr[i].childrens.length > 0) {\r\n\t\t\t\t\tnewArr.push({\r\n\t\t\t\t\t\tmenuId: arr[i].nodeId,\r\n\t\t\t\t\t\tmenuName: arr[i].nodeName,\r\n\t\t\t\t\t\tchilds: this.formatterMenu(arr[i].childrens)\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewArr.push({\r\n\t\t\t\t\t\tmenuId: arr[i].nodeId,\r\n\t\t\t\t\t\tmenuName: arr[i].nodeName\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn newArr;\r\n\t\t},\r\n\t\tasync findAccountByPage() {\r\n\t\t\tlet postData = {\r\n\t\t\t\tpage: this.cur_page,\r\n\t\t\t\tsize: this.pageSize,\r\n\t\t\t\tuserName: this.userNameSelect\r\n\t\t\t};\r\n\t\t\tlet {\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tdata: { content, total, list }\r\n\t\t\t\t}\r\n\t\t\t} = await this.$axios.post(this.BASE_URL + 'admin/account/findAccountByPage', postData);\r\n\r\n\t\t\tthis.tableData = list;\r\n\t\t\tthis.cur_total = total;\r\n\t\t\tthis.tableLoading = false;\r\n\t\t},\r\n\t\tformatter(row, column) {\r\n\t\t\treturn row.address;\r\n\t\t},\r\n\r\n\t\tfilterTag(value, row) {\r\n\t\t\treturn row.tag === value;\r\n\t\t},\r\n\t\thandleAdd() {\r\n\t\t\tthis.editVisible = true;\r\n\t\t},\r\n\t\thandlePassword(index, row) {\r\n\t\t\tthis.passwordVisible = true;\r\n\t\t\tthis.passwordForm = {\r\n\t\t\t\tid: row.id,\r\n\t\t\t\tuserName: row.userName,\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tnewPassword: '',\r\n\t\t\t\tagainPassword: ''\r\n\t\t\t};\r\n\t\t},\r\n\t\thandleUserNameChange(index, row) {\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveAccountInfo', {\r\n\t\t\t\t\tid: row.id,\r\n\t\t\t\t\tuserName: row.userName,\r\n\t\t\t\t\tpassword: row.password\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\t\tthis.editVisible = false;\r\n\t\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\thandleMenuAdd() {\r\n\t\t\tthis.menuForm = {\r\n\t\t\t\t//重置\r\n\t\t\t\tparentMenuId: [],\r\n\t\t\t\tmenuName: '',\r\n\t\t\t\tmenuUrl: '',\r\n\t\t\t\tmenuStatus: null\r\n\t\t\t};\r\n\t\t\tthis.initFrom();\r\n\t\t\tthis.menuEditVisible = true;\r\n\t\t},\r\n\t\thandleItemChange(val) {\r\n\t\t\tsetTimeout(_ => {\r\n\t\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=' + this.parentMenuIdOptions[val[0]].value).then(res => {\r\n\t\t\t\t\tvar list = res.data.data;\r\n\t\t\t\t\tif (list.length == 0) {\r\n\t\t\t\t\t\tthis.parentMenuIdOptions[val[0]].childs = '';\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var i = 0; i < list.length; i++) {\r\n\t\t\t\t\t\tthis.parentMenuIdOptions[val[0]].childs.push({\r\n\t\t\t\t\t\t\tvalue: res.data.data[i].menuId,\r\n\t\t\t\t\t\t\tlabel: res.data.data[i].menuName,\r\n\t\t\t\t\t\t\tchilds: []\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 300);\r\n\t\t},\r\n\t\thandleMenu(index, row) {\r\n\t\t\tthis.authorizeData = [];\r\n\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=').then(res => {\r\n\t\t\t\tthis.authorizeData = this.formatterMenu(res.data.data);\r\n\t\t\t\tconst formData = new FormData();\r\n\t\t\t\tformData.append('accountId', row.id);\r\n\t\t\t\tthis.$axios\r\n\t\t\t\t\t.post(this.BASE_URL + `admin/account/findAccountMenuByAccountId?accountId=${row.id}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tvar list = res.data.data;\r\n\t\t\t\t\t\tthis.$refs.authorzeTree.setCheckedKeys(list);\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tthis.authorizeForm.accountId = row.id;\r\n\t\t\tthis.authorizeVisible = true;\r\n\t\t},\r\n\t\thandleEdit(index, row) {\r\n\t\t\tthis.form = {\r\n\t\t\t\tuserName: row.userName\r\n\t\t\t};\r\n\t\t\tthis.editVisible = true;\r\n\t\t},\r\n\t\thandleDelete(index, row) {\r\n\t\t\tthis.delId = row.id;\r\n\t\t\tthis.delVisible = true;\r\n\t\t},\r\n\t\tdelAll() {\r\n\t\t\tconst length = this.multipleSelection.length;\r\n\t\t\tlet str = '';\r\n\t\t\tthis.del_list = this.del_list.concat(this.multipleSelection);\r\n\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\tstr += this.multipleSelection[i].name + ' ';\r\n\t\t\t}\r\n\t\t\tthis.$message.error('删除了' + str);\r\n\t\t\tthis.multipleSelection = [];\r\n\t\t},\r\n\t\thandleSelectionChange(val) {\r\n\t\t\tthis.multipleSelection = val;\r\n\t\t},\r\n\t\t//修改密码\r\n\t\tchangePassword() {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append('id', this.passwordForm.id);\r\n\t\t\tformData.append('oldPassword', this.passwordForm.oldPassword);\r\n\t\t\tformData.append('newPassword', this.passwordForm.newPassword);\r\n\t\t\tthis.$axios.post(this.BASE_URL + 'admin/account/changePassword', formData).then(res => {\r\n\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\tthis.passwordVisible = false;\r\n\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//新增菜单\r\n\t\tsaveMenuEdit() {\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveMenuInfo', {\r\n\t\t\t\t\tparentMenuId: this.menuForm.parentMenuId[this.menuForm.parentMenuId.length - 1],\r\n\t\t\t\t\tmenuName: this.menuForm.menuName,\r\n\t\t\t\t\tmenuUrl: this.menuForm.menuUrl,\r\n\t\t\t\t\tmenuStatus: this.menuForm.menuStatus\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (res.data.code == '200') {\r\n\t\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\t\tthis.menuEditVisible = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tsaveEdit() {\r\n\t\t\t// 保存编辑\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveAccountInfo', {\r\n\t\t\t\t\tuserName: this.form.userName,\r\n\t\t\t\t\tpassword: this.form.password\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\t\tthis.editVisible = false;\r\n\t\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tsaveAuthorize() {\r\n\t\t\t//更新授权\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveAccountMenuRelInfo', {\r\n\t\t\t\t\taccountId: this.authorizeForm.accountId,\r\n\t\t\t\t\thalfMenuIds: this.$refs.authorzeTree.getHalfCheckedKeys(),\r\n\t\t\t\t\tmenuIds: this.$refs.authorzeTree.getCheckedKeys()\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tthis.authorizeVisible = false;\r\n\t\t\t\t\tthis.$message.success(res.data.message);\r\n\t\t\t\t});\r\n\t\t},\r\n\t\t// 确定删除\r\n\t\tdeleteRow() {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append('accountId', this.delId);\r\n\t\t\tthis.$axios.post(this.BASE_URL + 'admin/account/delById', formData).then(res => {\r\n\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\tthis.$message.success(res.data.message);\r\n\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.delVisible = false;\r\n\t\t}\r\n\t}\r\n};\r\n",{"version":3,"sources":["account_manager.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"account_manager.vue","sourceRoot":"src/main/system","sourcesContent":["<template>\r\n\t<div class=\"table\">\r\n\t\t<div class=\"crumbs\">\r\n\t\t\t<el-breadcrumb separator=\"/\">\r\n\t\t\t\t<el-breadcrumb-item>\r\n\t\t\t\t\t<i class=\"el-icon-lx-cascades\"></i>\r\n\t\t\t\t\t用户管理\r\n\t\t\t\t</el-breadcrumb-item>\r\n\t\t\t</el-breadcrumb>\r\n\t\t</div>\r\n\t\t<div class=\"container\">\r\n\t\t\t<div class=\"handle-box\">\r\n\t\t\t\t<!-- <el-button type=\"primary\" icon=\"delete\" class=\"handle-del mr10\" @click=\"delAll\">批量删除</el-button> -->\r\n\t\t\t\t<el-input v-model=\"userNameSelect\" placeholder=\"用户名\" class=\"handle-input mr10\"></el-input>\r\n\t\t\t\t<el-button type=\"primary\" icon=\"search\" @click=\"search\">搜索</el-button>\r\n\t\t\t\t<el-button type=\"primary\" icon=\"delete\" class=\"handle-del mr10\" @click=\"handleAdd\">新增用户</el-button>\r\n\t\t\t\t<el-button type=\"primary\" icon=\"search\" @click=\"handleMenuAdd()\" class=\"mr10\">新增菜单</el-button>\r\n\t\t\t</div>\r\n\t\t\t<el-table :data=\"tableData\" v-loading=\"tableLoading\" border class=\"table\" ref=\"multipleTable\" @selection-change=\"handleSelectionChange\">\r\n\t\t\t\t<el-table-column type=\"selection\" width=\"55\" align=\"center\"></el-table-column>\r\n\t\t\t\t<el-table-column prop=\"id\" label=\"ID\" width=\"100\" align=\"center\"></el-table-column>\r\n\t\t\t\t<el-table-column prop=\"userName\" label=\"用户名\" sortable align=\"center\">\r\n\t\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t\t<el-input v-model=\"scope.row.userName\" placeholder=\"请输入内容\" @change=\"handleUserNameChange(scope.$index, scope.row)\"></el-input>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column prop=\"addDate\" label=\"注册日期\" align=\"center\"></el-table-column>\r\n\t\t\t\t<el-table-column label=\"操作\" align=\"center\">\r\n\t\t\t\t\t<template slot-scope=\"scope\">\r\n\t\t\t\t\t\t<el-button type=\"primary\" @click=\"handleMenu(scope.$index, scope.row)\">授权菜单</el-button>\r\n\t\t\t\t\t\t<el-button type=\"primary\" @click=\"handlePassword(scope.$index, scope.row)\">修改密码</el-button>\r\n\t\t\t\t\t\t<el-button type=\"primary\" @click=\"handleDelete(scope.$index, scope.row)\">删除</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t</el-table>\r\n\t\t\t<div class=\"pagination\">\r\n\t\t\t\t<el-pagination\r\n\t\t\t\t\tbackground\r\n\t\t\t\t\t@current-change=\"handleCurrentChange\"\r\n\t\t\t\t\t@size-change=\"handleSizeChange\"\r\n\t\t\t\t\tlayout=\"total, sizes, prev, pager, next, jumper\"\r\n\t\t\t\t\t:page-sizes=\"[10, 20, 50, 100]\"\r\n\t\t\t\t\t:total=\"cur_total\"\r\n\t\t\t\t\t:current-page.sync=\"currentPage\"\r\n\t\t\t\t></el-pagination>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 编辑弹出框 -->\r\n\t\t<el-dialog v-dialogDrag title=\"编辑\" :visible.sync=\"editVisible\" width=\"30%\">\r\n\t\t\t<el-form ref=\"form\" :model=\"form\" label-width=\"80px\">\r\n\t\t\t\t<el-form-item label=\"用户名\"><el-input v-model=\"form.userName\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"密码\"><el-input v-model=\"form.password\" type=\"password\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"确认密码\"><el-input v-model=\"form.againPassword\" type=\"password\"></el-input></el-form-item>\r\n\t\t\t</el-form>\r\n\t\t\t<span slot=\"footer\" class=\"dialog-footer\">\r\n\t\t\t\t<el-button @click=\"editVisible = false\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"saveEdit\">确 定</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\t\t<el-dialog v-dialogDrag title=\"修改密码\" :visible.sync=\"passwordVisible\" width=\"30%\">\r\n\t\t\t<el-form ref=\"passwordForm\" :model=\"form\" label-width=\"80px\">\r\n\t\t\t\t<el-form-item label=\"用户名\"><el-input placeholder=\"请输入内容\" v-model=\"passwordForm.userName\" :disabled=\"true\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"原密码\"><el-input v-model=\"passwordForm.oldPassword\" type=\"password\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"新密码\"><el-input v-model=\"passwordForm.newPassword\" type=\"password\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"确认密码\"><el-input v-model=\"passwordForm.againPassword\" type=\"password\"></el-input></el-form-item>\r\n\t\t\t</el-form>\r\n\t\t\t<span slot=\"footer\" class=\"dialog-footer\">\r\n\t\t\t\t<el-button @click=\"passwordVisible = false\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"changePassword\">保 存</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\t\t<el-dialog v-dialogDrag title=\"菜单授权\" :visible.sync=\"authorizeVisible\" width=\"50%\">\r\n\t\t\t<el-tree \r\n\t\t\t\t:data=\"authorizeData\" \r\n\t\t\t\tshow-checkbox \r\n\t\t\t\tnode-key=\"menuId\" \r\n\t\t\t\tref=\"authorzeTree\" \r\n\t\t\t\thighlight-current \r\n\t\t\t\t:props=\"defaultProps\">\r\n\t\t\t</el-tree>\r\n\t\t\t<span slot=\"footer\" class=\"dialog-footer\">\r\n\t\t\t\t<el-button @click=\"authorizeVisible = false\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"saveAuthorize\">更 新</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\t\t<el-dialog v-dialogDrag title=\"新增菜单\" :visible.sync=\"menuEditVisible\" width=\"50%\">\r\n\t\t\t<el-form ref=\"form\" :model=\"menuForm\" label-width=\"80px\">\r\n\t\t\t\t<el-form-item label=\"上级菜单\">\r\n\t\t\t\t\t<el-cascader \r\n\t\t\t\t\t\tv-model=\"menuForm.parentMenuId\" \r\n\t\t\t\t\t\t:options=\"parentMenuIdOptions\" \r\n\t\t\t\t\t\t:props=\"props\">\r\n\t\t\t\t\t</el-cascader>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t\t<el-form-item label=\"菜单名称\"><el-input v-model=\"menuForm.menuName\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"菜单路径\"><el-input v-model=\"menuForm.menuUrl\"></el-input></el-form-item>\r\n\t\t\t\t<el-form-item label=\"菜单状态\">\r\n\t\t\t\t\t<el-select v-model=\"menuForm.menuStatus\" placeholder=\"请选择\">\r\n\t\t\t\t\t\t<el-option label=\"禁用\" :value=\"0\"></el-option>\r\n\t\t\t\t\t\t<el-option label=\"启动\" :value=\"1\"></el-option>\r\n\t\t\t\t\t</el-select>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t</el-form>\r\n\t\t\t<span slot=\"footer\" class=\"dialog-footer\">\r\n\t\t\t\t<el-button @click=\"menuEditVisible = false\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"saveMenuEdit\">保 存</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\r\n\t\t<!-- 删除提示框 -->\r\n\t\t<el-dialog title=\"提示\" :visible.sync=\"delVisible\" width=\"300px\" center>\r\n\t\t\t<div class=\"del-dialog-cnt\">删除不可恢复，是否确定删除？</div>\r\n\t\t\t<span slot=\"footer\" class=\"dialog-footer\">\r\n\t\t\t\t<el-button @click=\"delVisible = false\">取 消</el-button>\r\n\t\t\t\t<el-button type=\"primary\" @click=\"deleteRow\">确 定</el-button>\r\n\t\t\t</span>\r\n\t\t</el-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tname: 'basetable',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttableLoading: true,\r\n\t\t\ttableData: [],\r\n\t\t\tcur_page: 1,\r\n\t\t\tcur_total: 0,\r\n\t\t\tpageSize: 10,\r\n\t\t\tcurrentPage: 1,\r\n\t\t\tmultipleSelection: [],\r\n\t\t\tuserNameSelect: '',\r\n\t\t\tdel_list: [],\r\n\t\t\tis_search: false,\r\n\t\t\teditVisible: false,\r\n\t\t\tdelVisible: false,\r\n\t\t\tmenuEditVisible: false,\r\n\t\t\tform: {\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tpassword: '',\r\n\t\t\t\tagainPassword: ''\r\n\t\t\t},\r\n\r\n\t\t\tmenuForm: {\r\n\t\t\t\tparentMenuId: [1],\r\n\t\t\t\tmenuName: '',\r\n\t\t\t\tmenuUrl: '',\r\n\t\t\t\tmenuStatus: null\r\n\t\t\t},\r\n\t\t\tparentMenuIdOptions: [],\r\n\t\t\tprops: {\r\n\t\t\t\tvalue: 'menuId',\r\n\t\t\t\tlabel: 'menuName',\r\n\t\t\t\tchildren: 'childs',\r\n\t\t\t\tcheckStrictly:true\r\n\t\t\t},\r\n\r\n\t\t\tpasswordVisible: false,\r\n\t\t\tpasswordForm: {\r\n\t\t\t\tid: '',\r\n\t\t\t\tuserName: '',\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tnewPassword: '',\r\n\t\t\t\tagainPassword: ''\r\n\t\t\t},\r\n\r\n\t\t\tauthorizeVisible: false,\r\n\t\t\tauthorizeData: [],\r\n\t\t\tauthorizeForm: {\r\n\t\t\t\taccountId: '',\r\n\t\t\t\tmenuIds: []\r\n\t\t\t},\r\n\t\t\tdefaultProps: {\r\n\t\t\t\tchildren: 'childs',\r\n\t\t\t\tvalue: 'menuId',\r\n\t\t\t\tlabel: 'menuName'\r\n\t\t\t},\r\n\t\t\tdelId: -1\r\n\t\t};\r\n\t},\r\n\tcreated() {\r\n\t\tthis.findAccountByPage();\r\n\t\tthis.getData();\r\n\t},\r\n\tmethods: {\r\n\t\t// 分页导航\r\n\t\thandleCurrentChange(val) {\r\n\t\t\tthis.currentPage = val;\r\n\t\t\tthis.cur_page = val;\r\n\t\t\tthis.findAccountByPage();\r\n\t\t},\r\n\t\thandleSizeChange(val) {\r\n\t\t\tthis.currentPage = 1;\r\n\t\t\tthis.cur_page = 1;\r\n\t\t\tthis.pageSize = val;\r\n\t\t\tthis.findAccountByPage();\r\n\t\t},\r\n\t\t// 获取 easy-mock 的模拟数据\r\n\t\tgetData() {\r\n\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=').then(res => {\r\n\t\t\t\tvar list = res.data.data;\r\n\t\t\t\tfor (var i = 0; i < list.length; i++) {\r\n\t\t\t\t\tvar childsTemp = '';\r\n\t\t\t\t\tif (res.data.data[i].childs != null && res.data.data[i].childs != 0) {\r\n\t\t\t\t\t\tchildsTemp = res.data.data[i].childs;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.authorizeData.push({\r\n\t\t\t\t\t\tmenuId: res.data.data[i].menuId,\r\n\t\t\t\t\t\tmenuName: res.data.data[i].menuName,\r\n\t\t\t\t\t\tchilds: childsTemp\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tsearch() {\r\n\t\t\tthis.cur_page = 1;\r\n\t\t\tthis.findAccountByPage();\r\n\t\t},\r\n\t\tinitFrom() {\r\n\t\t\t//初始表单数据\r\n\t\t\tthis.parentMenuIdOptions = [];\r\n\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=').then(res => {\r\n\t\t\t\tthis.parentMenuIdOptions = this.formatterMenu(res.data.data);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 格式化菜单数据\r\n\t\tformatterMenu(arr) {\r\n\t\t\tlet newArr = [];\r\n\t\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\t\tif (arr[i].childrens && arr[i].childrens.length > 0) {\r\n\t\t\t\t\tnewArr.push({\r\n\t\t\t\t\t\tmenuId: arr[i].nodeId,\r\n\t\t\t\t\t\tmenuName: arr[i].nodeName,\r\n\t\t\t\t\t\tchilds: this.formatterMenu(arr[i].childrens)\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewArr.push({\r\n\t\t\t\t\t\tmenuId: arr[i].nodeId,\r\n\t\t\t\t\t\tmenuName: arr[i].nodeName\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn newArr;\r\n\t\t},\r\n\t\tasync findAccountByPage() {\r\n\t\t\tlet postData = {\r\n\t\t\t\tpage: this.cur_page,\r\n\t\t\t\tsize: this.pageSize,\r\n\t\t\t\tuserName: this.userNameSelect\r\n\t\t\t};\r\n\t\t\tlet {\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tdata: { content, total, list }\r\n\t\t\t\t}\r\n\t\t\t} = await this.$axios.post(this.BASE_URL + 'admin/account/findAccountByPage', postData);\r\n\r\n\t\t\tthis.tableData = list;\r\n\t\t\tthis.cur_total = total;\r\n\t\t\tthis.tableLoading = false;\r\n\t\t},\r\n\t\tformatter(row, column) {\r\n\t\t\treturn row.address;\r\n\t\t},\r\n\r\n\t\tfilterTag(value, row) {\r\n\t\t\treturn row.tag === value;\r\n\t\t},\r\n\t\thandleAdd() {\r\n\t\t\tthis.editVisible = true;\r\n\t\t},\r\n\t\thandlePassword(index, row) {\r\n\t\t\tthis.passwordVisible = true;\r\n\t\t\tthis.passwordForm = {\r\n\t\t\t\tid: row.id,\r\n\t\t\t\tuserName: row.userName,\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tnewPassword: '',\r\n\t\t\t\tagainPassword: ''\r\n\t\t\t};\r\n\t\t},\r\n\t\thandleUserNameChange(index, row) {\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveAccountInfo', {\r\n\t\t\t\t\tid: row.id,\r\n\t\t\t\t\tuserName: row.userName,\r\n\t\t\t\t\tpassword: row.password\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\t\tthis.editVisible = false;\r\n\t\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\thandleMenuAdd() {\r\n\t\t\tthis.menuForm = {\r\n\t\t\t\t//重置\r\n\t\t\t\tparentMenuId: [],\r\n\t\t\t\tmenuName: '',\r\n\t\t\t\tmenuUrl: '',\r\n\t\t\t\tmenuStatus: null\r\n\t\t\t};\r\n\t\t\tthis.initFrom();\r\n\t\t\tthis.menuEditVisible = true;\r\n\t\t},\r\n\t\thandleItemChange(val) {\r\n\t\t\tsetTimeout(_ => {\r\n\t\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=' + this.parentMenuIdOptions[val[0]].value).then(res => {\r\n\t\t\t\t\tvar list = res.data.data;\r\n\t\t\t\t\tif (list.length == 0) {\r\n\t\t\t\t\t\tthis.parentMenuIdOptions[val[0]].childs = '';\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var i = 0; i < list.length; i++) {\r\n\t\t\t\t\t\tthis.parentMenuIdOptions[val[0]].childs.push({\r\n\t\t\t\t\t\t\tvalue: res.data.data[i].menuId,\r\n\t\t\t\t\t\t\tlabel: res.data.data[i].menuName,\r\n\t\t\t\t\t\t\tchilds: []\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 300);\r\n\t\t},\r\n\t\thandleMenu(index, row) {\r\n\t\t\tthis.authorizeData = [];\r\n\t\t\tthis.$axios.get(this.BASE_URL + 'admin/account/findMenuByParentId?parentMenuId=').then(res => {\r\n\t\t\t\tthis.authorizeData = this.formatterMenu(res.data.data);\r\n\t\t\t\tconst formData = new FormData();\r\n\t\t\t\tformData.append('accountId', row.id);\r\n\t\t\t\tthis.$axios\r\n\t\t\t\t\t.post(this.BASE_URL + `admin/account/findAccountMenuByAccountId?accountId=${row.id}`)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tvar list = res.data.data;\r\n\t\t\t\t\t\tthis.$refs.authorzeTree.setCheckedKeys(list);\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tthis.authorizeForm.accountId = row.id;\r\n\t\t\tthis.authorizeVisible = true;\r\n\t\t},\r\n\t\thandleEdit(index, row) {\r\n\t\t\tthis.form = {\r\n\t\t\t\tuserName: row.userName\r\n\t\t\t};\r\n\t\t\tthis.editVisible = true;\r\n\t\t},\r\n\t\thandleDelete(index, row) {\r\n\t\t\tthis.delId = row.id;\r\n\t\t\tthis.delVisible = true;\r\n\t\t},\r\n\t\tdelAll() {\r\n\t\t\tconst length = this.multipleSelection.length;\r\n\t\t\tlet str = '';\r\n\t\t\tthis.del_list = this.del_list.concat(this.multipleSelection);\r\n\t\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\t\tstr += this.multipleSelection[i].name + ' ';\r\n\t\t\t}\r\n\t\t\tthis.$message.error('删除了' + str);\r\n\t\t\tthis.multipleSelection = [];\r\n\t\t},\r\n\t\thandleSelectionChange(val) {\r\n\t\t\tthis.multipleSelection = val;\r\n\t\t},\r\n\t\t//修改密码\r\n\t\tchangePassword() {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append('id', this.passwordForm.id);\r\n\t\t\tformData.append('oldPassword', this.passwordForm.oldPassword);\r\n\t\t\tformData.append('newPassword', this.passwordForm.newPassword);\r\n\t\t\tthis.$axios.post(this.BASE_URL + 'admin/account/changePassword', formData).then(res => {\r\n\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\tthis.passwordVisible = false;\r\n\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t//新增菜单\r\n\t\tsaveMenuEdit() {\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveMenuInfo', {\r\n\t\t\t\t\tparentMenuId: this.menuForm.parentMenuId[this.menuForm.parentMenuId.length - 1],\r\n\t\t\t\t\tmenuName: this.menuForm.menuName,\r\n\t\t\t\t\tmenuUrl: this.menuForm.menuUrl,\r\n\t\t\t\t\tmenuStatus: this.menuForm.menuStatus\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (res.data.code == '200') {\r\n\t\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\t\tthis.menuEditVisible = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tsaveEdit() {\r\n\t\t\t// 保存编辑\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveAccountInfo', {\r\n\t\t\t\t\tuserName: this.form.userName,\r\n\t\t\t\t\tpassword: this.form.password\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\t\tthis.editVisible = false;\r\n\t\t\t\t\t\tthis.$message.success('保存成功');\r\n\t\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t},\r\n\t\tsaveAuthorize() {\r\n\t\t\t//更新授权\r\n\t\t\tthis.$axios\r\n\t\t\t\t.post(this.BASE_URL + 'admin/account/saveAccountMenuRelInfo', {\r\n\t\t\t\t\taccountId: this.authorizeForm.accountId,\r\n\t\t\t\t\thalfMenuIds: this.$refs.authorzeTree.getHalfCheckedKeys(),\r\n\t\t\t\t\tmenuIds: this.$refs.authorzeTree.getCheckedKeys()\r\n\t\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tthis.authorizeVisible = false;\r\n\t\t\t\t\tthis.$message.success(res.data.message);\r\n\t\t\t\t});\r\n\t\t},\r\n\t\t// 确定删除\r\n\t\tdeleteRow() {\r\n\t\t\tconst formData = new FormData();\r\n\t\t\tformData.append('accountId', this.delId);\r\n\t\t\tthis.$axios.post(this.BASE_URL + 'admin/account/delById', formData).then(res => {\r\n\t\t\t\tif (res.data.code == 200) {\r\n\t\t\t\t\tthis.$message.success(res.data.message);\r\n\t\t\t\t\tthis.findAccountByPage();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error(res.data.message);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.delVisible = false;\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.handle-box {\r\n\tmargin-bottom: 15px;\r\n}\r\n\r\n.handle-select {\r\n\twidth: 120px;\r\n}\r\n\r\n.handle-input {\r\n\twidth: 200px;\r\n\tdisplay: inline-block;\r\n}\r\n.del-dialog-cnt {\r\n\tfont-size: 16px;\r\n\ttext-align: center;\r\n}\r\n.table {\r\n\twidth: 100%;\r\n\tfont-size: 14px;\r\n}\r\n.red {\r\n\tcolor: #ff0000;\r\n}\r\n.mr10 {\r\n\tmargin-right: 10px;\r\n}\r\n</style>\n"]}]}